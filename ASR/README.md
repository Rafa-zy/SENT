# SENT for ASR

## Data Preparation

1. Download [AISHELL-1](https://catalog.ldc.upenn.edu/LDC2018S14) data.
2. Generate noisy datasets by following steps below:
   
    a. Train a small model (use small model size by changing parameters in `config.yml`) on the original AISHELL-1 datasets by using `pretrain.sh`.

    b. Generate noise on the original training sets by using `pollute.sh`.

    c. Train a model (use normal model size) on the noisy training sets generated from step 2 to learn the noise distribution using `pretrain.sh`

    d. Use the model from step 3 to transfer the noise to development set using `pollute.sh`.

3. According to the noisy level we want, the model trained in step 1 should not fully converge. The recommended training rounds is 50% of the full for a medium level noisy rate. 
4. Please read instructions in each python file.
5. We have also provided the generated JSON files for three different noisy levels which are used in our paper. Feel free to use them. Please see the table below for more details.

| Noisy Level   | Train Path | Dev Path | Meta Path | Meta Dev Path| Vocab Path
|:--------------|:-----|:-----------|:-----------|:-----------|:-----------|
| original |  data/aishell1_original_train.json |  data/aishell1_original_dev.json |     None | data/aishell1_original_test.json | data/vocab_aishell1.txt|
| better      | data/aishell_bettermini.json | data/aishell_dev_bettermini.json|   data/aishell_meta_bettermini.json |  data/aishell_metadev_bettermini.json |aishell1_original_test.json | data/vocab_aishell1_better.txt|
| normal      | data/aishell_normalmini.json | data/aishell_dev_normalmini.json|   data/aishell_meta_normalmini.json |  data/aishell_metadev_normalmini.json |aishell1_original_test.json | data/vocab_aishell1_normal.txt|
| worse      | data/aishell_worsemini.json | data/aishell_dev_worsemini.json|   data/aishell_meta_worsemini.json |  data/aishell_metadev_worsemini.json |aishell1_original_test.json | data/vocab_aishell1_worse.txt|

Here original represents the original AISHELL-1 dataset without noise. Better, Normal, and Worse represents the noisy levels from light to severe. 



## Model Training & Testing

1. First, prepare data as mentioned above. If you are using the JSON files generated by us, make sure you match the audio file path correctly.
2. Use the parameter set for desired noisy level and run `train.sh` (Here we use normal model size). Parameters such as training rounds and others are different for each noisy level. Please check the corresponding parameters for each noisy level in `config.yml`.
3. Run `pretrain.sh` with the same `config.yml` as step 2 to get a baseline for the corresponding noisy level you are experimenting on.
4. Use `test.py` for testing.